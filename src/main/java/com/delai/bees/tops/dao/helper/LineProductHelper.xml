<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.delai.bees.tops.dao.LineProductMapper">



  <resultMap id="LineProdcutTimeCrossingSumBaseResultMap" type="com.delai.bees.tops.entity.domain.LineProdcutTimeCrossingSum">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 08 11:07:28 CST 2019.
    -->
    <result column="Products_Sum" jdbcType="INTEGER" property="productsSum" />
    <result column="Stacker_Product_Sum" jdbcType="INTEGER" property="stackerProductSum" />
    <result column="Bottle_Blowing_Product_Sum" jdbcType="INTEGER" property="bottleBlowingProductSum" />
    <result column="Implanter_Product_Sum" jdbcType="INTEGER" property="implanterProductSum" />
    <result column="Time_Sum" jdbcType="INTEGER" property="timeSum" />
  </resultMap>

  <select id="calProductsAccordingTimeCrossing" resultMap="LineProdcutTimeCrossingSumBaseResultMap">
    SELECT
      SUM(Products) * (1 - (GREATEST(0, round((UNIX_TIMESTAMP(#{begin})-UNIX_TIMESTAMP(`On`))/60)) + GREATEST(0, round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(#{end}))/60))) / SUM(round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(`On`))/60))) AS Products_Sum,
      SUM(Stacker_Product) * (1 - (GREATEST(0, round((UNIX_TIMESTAMP(#{begin})-UNIX_TIMESTAMP(`On`))/60)) + GREATEST(0, round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(#{end}))/60))) / SUM(round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(`On`))/60))) AS Stacker_Product_Sum,
      SUM(Bottle_Blowing_Product) * ( 1 - (GREATEST(0, round((UNIX_TIMESTAMP(#{begin})-UNIX_TIMESTAMP(`On`))/60)) + GREATEST(0, round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(#{end}))/60))) / SUM(round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(`On`))/60))) AS Bottle_Blowing_Product_Sum,
      SUM(Implanter_Product) * (1 - (GREATEST(0, round((UNIX_TIMESTAMP(#{begin})-UNIX_TIMESTAMP(`On`))/60)) + GREATEST(0, round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(#{end}))/60))) / SUM(round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(`On`))/60))) AS Implanter_Product_Sum,
      SUM(round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(`On`))/60)) - (GREATEST(0, round((UNIX_TIMESTAMP(#{begin})-UNIX_TIMESTAMP(`On`))/60)) + GREATEST(0, round((UNIX_TIMESTAMP(`Off`)-UNIX_TIMESTAMP(#{end}))/60))) AS Time_Sum
    FROM Line_Product WHERE `Off` &gt; #{begin}  AND `On` &lt; #{end};
  </select>
</mapper>